<video autoplay muted loop playsinline class="video-background">
  <source src="assets/principal.mp4" type="video/mp4" />
  Tu navegador no soporta video HTML5.
</video>

<!-- Botón de regreso al menú -->
<button class="back-menu-btn" (click)="goToMenu()">
  ← Menú
</button>

<div class="container">
  <div class="content-wrapper">
    <!-- Header -->
    <div class="header">
      <div class="header-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
      </div>
      <h1>División de Factura</h1>
      <p>Gestión mensual de servicios públicos</p>
    </div>

    <!-- Bill Selector -->
    <div class="card">
      <div class="card-header">
        <div class="card-header-left">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <h2>Factura Actual</h2>
        </div>
        <div class="button-group">
          <button class="btn-primary" (click)="addNewBill()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Nueva Factura
          </button>
          <button class="btn-download" (click)="downloadBill()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Descargar
          </button>
          <button class="btn-secondary" (click)="toggleHistory()">
            {{ showHistory ? 'Ocultar' : 'Ver' }} Historial ({{ bills.length }})
          </button>
        </div>
      </div>

      <div class="period-input">
        <label>Periodo:</label>
        <input type="text" [value]="currentBill.month" (input)="updateMonth($any($event.target).value)" placeholder="Ej: Noviembre 2025">
      </div>

      <!-- History Dropdown -->
      <div *ngIf="showHistory" class="history-list">
        <div *ngFor="let bill of bills; let i = index"
             class="history-item"
             [class.active]="i === currentBillIndex"
             (click)="selectBill(i)">
          <div>
            <p class="history-month">{{ bill.month || 'Sin nombre' }}</p>
            <p class="history-total">Total: ${{ formatCurrency(getBillTotal(bill)) }}</p>
          </div>
          <button class="btn-delete" (click)="deleteBill(i); $event.stopPropagation()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Number of Tenants -->
    <div class="card">
      <div class="tenants-control">
        <div class="tenants-label">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <label>Número de Pisos/Inquilinos</label>
        </div>
        <div class="tenants-buttons">
          <button (click)="decrementTenants()">-</button>
          <span>{{ numTenants }}</span>
          <button (click)="incrementTenants()">+</button>
        </div>
      </div>
    </div>



      <!-- Consumo -->
      <div>
        <div class="section-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="green-icon">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <h3>Consumo (Se divide entre inquilinos)</h3>
        </div>

        <div class="card-green">
          <div class="card-icon-header">
            <div class="icon-wrapper green">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
              </svg>
            </div>
            <h2>Consumo de Gas</h2>
          </div>
          <div class="input-group">
            <div class="input-field">
              <label>Con subsidio</label>
              <div class="input-wrapper">
                <span class="currency">$</span>
                <input type="number" [value]="currentBill.consumption.withSubsidy" (input)="updateConsumption('withSubsidy', +$any($event.target).value || 0)" step="0.01">
              </div>
            </div>
            <div class="input-field">
              <label>Subsidio</label>
              <div class="input-wrapper">
                <span class="currency">$</span>
                <input type="number" [value]="currentBill.consumption.subsidy" (input)="updateConsumption('subsidy', +$any($event.target).value || 0)" step="0.01">
              </div>
            </div>
            <div class="input-field">
              <label>Ajuste decena</label>
              <div class="input-wrapper">
                <span class="currency">$</span>
                <input type="number" [value]="currentBill.consumption.adjustment" (input)="updateConsumption('adjustment', +$any($event.target).value || 0)" step="0.01">
              </div>
            </div>
            <div class="total-row">
              <span>Total Consumo:</span>
              <span class="total-value green">${{ formatCurrency(totalConsumption) }}</span>
            </div>
          </div>
        </div>
      </div>








    <!-- Results Summary -->
    <div class="summary-card">
      <div class="summary-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
          <line x1="8" y1="6" x2="16" y2="6"></line>
          <line x1="8" y1="10" x2="16" y2="10"></line>
          <line x1="8" y1="14" x2="12" y2="14"></line>
          <line x1="8" y1="18" x2="12" y2="18"></line>
        </svg>
        <h2>Resumen de División</h2>
      </div>

      <div class="summary-stats">
        <div class="stat-card">
          <p class="stat-label">Total Factura</p>
          <p class="stat-value">${{ formatCurrency(totalBill) }}</p>
        </div>
        <div class="stat-card">
          <p class="stat-label">Por Piso/Inquilino</p>
          <p class="stat-value">${{ formatCurrency(perTenant) }}</p>
        </div>
      </div>

      <div class="summary-details">
        <div class="detail-card">
          <div class="detail-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="green-icon">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <h3>Cada Inquilino/Piso Paga</h3>
          </div>
          <div class="detail-content">
            <div class="detail-row">
              <span>Consumo de gas:</span>
              <span>${{ formatCurrency(totalConsumption / numTenants) }}</span>
            </div>
            <div class="detail-total">
              <span>Total por Piso:</span>
              <span class="green">${{ formatCurrency(perTenant) }}</span>
            </div>
            <div class="detail-verification">
              <p><strong>Total {{ numTenants }} pisos:</strong> ${{ formatCurrency(perTenant * numTenants) }}</p>
            </div>
          </div>
        </div>


      <div class="verification-box">
        <p>
          <strong>Verificación:</strong> Inquilinos ({{ numTenants }} × ${{ formatCurrency(perTenant) }} = ${{ formatCurrency(perTenant * numTenants) }})
        </p>
      </div>
    </div>
  </div>
</div>
