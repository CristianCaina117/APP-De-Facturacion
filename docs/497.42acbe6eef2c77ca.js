"use strict";(self.webpackChunkFacturacion=self.webpackChunkFacturacion||[]).push([[497],{7497:(nt,k,v)=>{v.r(k),v.d(k,{AguaComponent:()=>ot});var y=v(2200),u=v(4341),m=function(r){return r[r.State=0]="State",r[r.Transition=1]="Transition",r[r.Sequence=2]="Sequence",r[r.Group=3]="Group",r[r.Animate=4]="Animate",r[r.Keyframes=5]="Keyframes",r[r.Style=6]="Style",r[r.Trigger=7]="Trigger",r[r.Reference=8]="Reference",r[r.AnimateChild=9]="AnimateChild",r[r.AnimateRef=10]="AnimateRef",r[r.Query=11]="Query",r[r.Stagger=12]="Stagger",r}(m||{});function j(r,n){return{type:m.Trigger,name:r,definitions:n,options:{}}}function E(r,n=null){return{type:m.Animate,styles:n,timings:r}}function _(r){return{type:m.Style,styles:r,offset:null}}function w(r,n,e=null){return{type:m.Transition,expr:r,animation:n,options:e}}function D(r,n,e=null){return{type:m.Query,selector:r,animation:n,options:e}}function A(r,n){return{type:m.Stagger,timings:r,animation:n}}var t=v(3664),l=v(2615),C=v(8686);function R(r,n){if(1&r&&(t.j41(0,"div",36)(1,"span",37),t.EFF(2,"\u26a0\ufe0f"),t.k0s(),t.EFF(3),t.k0s()),2&r){const e=t.XpG(2);t.R7$(3),t.SpI(" ",e.getErrorMessage("totalAmount")," ")}}function z(r,n){if(1&r&&(t.j41(0,"div",36)(1,"span",37),t.EFF(2,"\u26a0\ufe0f"),t.k0s(),t.EFF(3),t.k0s()),2&r){const e=t.XpG(2);t.R7$(3),t.SpI(" ",e.getErrorMessage("numberOfFloors")," ")}}function S(r,n){if(1&r){const e=t.RV6();t.j41(0,"div",18)(1,"div",19)(2,"h2",20),t.EFF(3,"\u{1f4cb} Informaci\xf3n General"),t.k0s(),t.j41(4,"p",21),t.EFF(5,"Ingresa el monto total de la factura y el n\xfamero de pisos del edificio"),t.k0s()(),t.j41(6,"form",22)(7,"div",23)(8,"label",24),t.EFF(9," \u{1f4b0} Total de la Factura de Agua "),t.k0s(),t.j41(10,"div",25)(11,"span",26),t.EFF(12,"$"),t.k0s(),t.j41(13,"input",27),t.bIt("blur",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.onFieldChange("totalAmount"))})("input",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.onFieldChange("totalAmount"))}),t.k0s()(),t.DNE(14,R,4,1,"div",28),t.j41(15,"div",29)(16,"span",30),t.EFF(17,"\u{1f4a1}"),t.k0s(),t.EFF(18," Ingresa el valor total sin comas ni puntos adicionales "),t.k0s()(),t.j41(19,"div",23)(20,"label",31),t.EFF(21," \u{1f3e2} N\xfamero de Pisos "),t.k0s(),t.j41(22,"div",25)(23,"input",32),t.bIt("blur",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.onFieldChange("numberOfFloors"))})("input",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.onFieldChange("numberOfFloors"))}),t.k0s()(),t.DNE(24,z,4,1,"div",28),t.j41(25,"div",29)(26,"span",30),t.EFF(27,"\u{1f4a1}"),t.k0s(),t.EFF(28," M\xe1ximo 20 pisos permitidos "),t.k0s()(),t.j41(29,"div",33)(30,"button",34),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.onNextStep())}),t.j41(31,"span",35),t.EFF(32,"\u{1f465}"),t.k0s(),t.EFF(33," Continuar a Pisos "),t.k0s()()()()}if(2&r){const e=t.XpG();t.R7$(6),t.Y8G("formGroup",e.aguaForm),t.R7$(4),t.AVh("error",e.hasError("totalAmount")),t.R7$(4),t.Y8G("ngIf",e.hasError("totalAmount")),t.R7$(8),t.AVh("error",e.hasError("numberOfFloors")),t.R7$(2),t.Y8G("ngIf",e.hasError("numberOfFloors")),t.R7$(6),t.Y8G("disabled",!e.isStep1Valid())}}function $(r,n){1&r&&(t.j41(0,"span"),t.EFF(1,"\u2705"),t.k0s())}function I(r,n){1&r&&(t.j41(0,"span"),t.EFF(1,"\u274c"),t.k0s())}function G(r,n){if(1&r&&(t.j41(0,"div",36)(1,"span",37),t.EFF(2,"\u26a0\ufe0f"),t.k0s(),t.EFF(3),t.k0s()),2&r){const e=t.XpG().index,o=t.XpG(2);t.R7$(3),t.SpI(" ",o.getErrorMessage("people",e)," ")}}function T(r,n){if(1&r&&(t.j41(0,"div",36)(1,"span",37),t.EFF(2,"\u26a0\ufe0f"),t.k0s(),t.EFF(3),t.k0s()),2&r){const e=t.XpG().index,o=t.XpG(2);t.R7$(3),t.SpI(" ",o.getErrorMessage("adjustment",e)," ")}}function P(r,n){1&r&&(t.j41(0,"div",29)(1,"span",30),t.EFF(2,"\u{1f504}"),t.k0s(),t.EFF(3," Esta reducci\xf3n se redistribuir\xe1 autom\xe1ticamente "),t.k0s())}function Y(r,n){if(1&r&&(t.j41(0,"div",36)(1,"span",37),t.EFF(2,"\u26a0\ufe0f"),t.k0s(),t.EFF(3),t.k0s()),2&r){const e=t.XpG().index,o=t.XpG(2);t.R7$(3),t.SpI(" ",o.getErrorMessage("adjustmentReason",e)," ")}}function N(r,n){if(1&r){const e=t.RV6();t.j41(0,"div",48)(1,"div",49)(2,"div",50)(3,"span",51),t.EFF(4,"\u{1f3e0}"),t.k0s(),t.EFF(5),t.k0s(),t.j41(6,"div",52),t.DNE(7,$,2,0,"span",53)(8,I,2,0,"span",53),t.k0s()(),t.j41(9,"div",54)(10,"div",23)(11,"label",55),t.EFF(12," \u{1f464} Cantidad de Personas "),t.k0s(),t.j41(13,"div",56)(14,"input",57),t.bIt("blur",function(){const a=l.eBV(e).index,i=t.XpG(2);return l.Njj(i.onFieldChange("people",a))})("input",function(){const a=l.eBV(e).index,i=t.XpG(2);return l.Njj(i.onFieldChange("people",a))}),t.k0s()(),t.DNE(15,G,4,1,"div",28),t.k0s(),t.j41(16,"div",23)(17,"label",55),t.EFF(18," \u2696\ufe0f Ajuste Manual "),t.j41(19,"span",58),t.EFF(20,"(+ aumentar / - reducir)"),t.k0s()(),t.j41(21,"div",56)(22,"span",59),t.EFF(23,"$"),t.k0s(),t.j41(24,"input",60),t.bIt("blur",function(){const a=l.eBV(e).index,i=t.XpG(2);return l.Njj(i.onFieldChange("adjustment",a))})("input",function(){const a=l.eBV(e).index,i=t.XpG(2);return l.Njj(i.onFieldChange("adjustment",a))}),t.k0s()(),t.DNE(25,T,4,1,"div",28)(26,P,4,0,"div",61),t.k0s(),t.j41(27,"div",23)(28,"label",55),t.EFF(29," \u{1f4dd} Motivo del Ajuste (Opcional) "),t.k0s(),t.j41(30,"input",62),t.bIt("blur",function(){const a=l.eBV(e).index,i=t.XpG(2);return l.Njj(i.onFieldChange("adjustmentReason",a))}),t.k0s(),t.j41(31,"div",29)(32,"span",30),t.EFF(33,"\u{1f4a1}"),t.k0s(),t.EFF(34," Ayuda a recordar por qu\xe9 se aplic\xf3 este ajuste "),t.k0s(),t.DNE(35,Y,4,1,"div",28),t.k0s()()()}if(2&r){let e,o,a,i,d;const g=n.$implicit,c=n.index,f=t.XpG(2);t.Y8G("formGroup",g),t.BMQ("data-floor",c+1),t.R7$(5),t.SpI(" Piso ",null==(e=g.get("floorNumber"))?null:e.value," "),t.R7$(),t.AVh("valid",!f.hasError("people",c)&&(null==(o=g.get("people"))?null:o.value)>0),t.R7$(),t.Y8G("ngIf",!f.hasError("people",c)&&(null==(a=g.get("people"))?null:a.value)>0),t.R7$(),t.Y8G("ngIf",f.hasError("people",c)),t.R7$(5),t.AVh("error",f.hasError("people",c))("success",!f.hasError("people",c)&&(null==(i=g.get("people"))?null:i.value)>0),t.R7$(2),t.Y8G("ngIf",f.hasError("people",c)),t.R7$(6),t.AVh("error",f.hasError("adjustment",c)),t.R7$(4),t.Y8G("ngIf",f.hasError("adjustment",c)),t.R7$(),t.Y8G("ngIf",(null==(d=g.get("adjustment"))?null:d.value)<0),t.R7$(9),t.Y8G("ngIf",f.hasError("adjustmentReason",c))}}function X(r,n){1&r&&(t.j41(0,"span",63)(1,"span",35),t.EFF(2,"\u{1f9ee}"),t.k0s(),t.EFF(3," Calcular con Redistribuci\xf3n "),t.k0s())}function O(r,n){1&r&&(t.j41(0,"span",64),t.nrm(1,"span",65),t.EFF(2," Calculando... "),t.k0s())}function V(r,n){if(1&r){const e=t.RV6();t.j41(0,"div",38)(1,"div",19)(2,"h2",20),t.EFF(3,"\u{1f465} Personas por Piso"),t.k0s(),t.j41(4,"p",21),t.EFF(5,"Ingresa la cantidad de personas y ajustes por consumo para cada piso"),t.k0s(),t.j41(6,"div",39)(7,"div",40),t.EFF(8," \u2139\ufe0f Los ajustes negativos se redistribuir\xe1n autom\xe1ticamente entre los dem\xe1s pisos "),t.k0s()()(),t.j41(9,"form",22)(10,"div",41),t.DNE(11,N,36,17,"div",42),t.k0s(),t.j41(12,"div",43)(13,"button",44),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.onPreviousStep())}),t.j41(14,"span",35),t.EFF(15,"\u2190"),t.k0s(),t.EFF(16," Anterior "),t.k0s(),t.j41(17,"button",45),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.onNextStep())}),t.DNE(18,X,4,0,"span",46)(19,O,3,0,"span",47),t.k0s()()()()}if(2&r){const e=t.XpG();t.R7$(9),t.Y8G("formGroup",e.aguaForm),t.R7$(2),t.Y8G("ngForOf",e.floorFormGroups),t.R7$(6),t.AVh("loading",e.isCalculating),t.Y8G("disabled",!e.isStep2Valid()||e.isCalculating),t.R7$(),t.Y8G("ngIf",!e.isCalculating),t.R7$(),t.Y8G("ngIf",e.isCalculating)}}function B(r,n){if(1&r&&(t.j41(0,"div",73)(1,"div",68),t.EFF(2,"\u{1f504}"),t.k0s(),t.j41(3,"div",69)(4,"div",70),t.EFF(5),t.k0s(),t.j41(6,"div",71),t.EFF(7,"Redistribuido"),t.k0s()()()),2&r){const e=t.XpG(2);t.R7$(5),t.JRh(e.formatCurrency(e.calculation.redistributionDetails.totalRedistributed))}}function M(r,n){if(1&r&&(t.j41(0,"div",39)(1,"div",40),t.EFF(2," \u{1f504} "),t.j41(3,"strong"),t.EFF(4,"Redistribuci\xf3n Autom\xe1tica:"),t.k0s(),t.EFF(5),t.k0s()()),2&r){const e=t.XpG(2);t.R7$(5),t.SpI(" ",e.getRedistributionInfo()," ")}}function L(r,n){1&r&&(t.j41(0,"span",110),t.EFF(1,"Reducci\xf3n"),t.k0s())}function q(r,n){1&r&&(t.j41(0,"span",111),t.EFF(1,"+Redistribuci\xf3n"),t.k0s())}function J(r,n){if(1&r&&(t.j41(0,"small",115),t.EFF(1),t.k0s()),2&r){const e=t.XpG(2).$implicit;t.R7$(),t.JRh(e.adjustmentReason)}}function U(r,n){if(1&r&&(t.j41(0,"div",112)(1,"span",103)(2,"span",113),t.EFF(3),t.k0s(),t.DNE(4,J,2,1,"small",114),t.k0s(),t.j41(5,"span",104),t.EFF(6),t.k0s()()),2&r){const e=t.XpG().$implicit,o=t.XpG(2);t.R7$(3),t.SpI("",e.adjustment>0?"Ajuste (+)":"Reducci\xf3n (-)",":"),t.R7$(),t.Y8G("ngIf",e.adjustmentReason),t.R7$(),t.AVh("positive",e.adjustment>0)("negative",e.adjustment<0),t.R7$(),t.SpI(" ",o.formatCurrency(e.adjustment)," ")}}function W(r,n){if(1&r&&(t.j41(0,"div",116)(1,"span",117),t.EFF(2," Redistribuci\xf3n recibida: "),t.k0s(),t.j41(3,"span",118),t.EFF(4),t.k0s()()),2&r){const e=t.XpG().$implicit,o=t.XpG(2);t.R7$(4),t.SpI(" +",o.formatCurrency(e.redistributedAmount)," ")}}function Q(r,n){if(1&r&&(t.j41(0,"div",91)(1,"div",92)(2,"div",93)(3,"span",94)(4,"span",95),t.EFF(5,"\u{1f3e0}"),t.k0s(),t.EFF(6),t.k0s(),t.j41(7,"span",96),t.EFF(8),t.k0s(),t.j41(9,"div",97),t.DNE(10,L,2,0,"span",98)(11,q,2,0,"span",99),t.k0s()(),t.j41(12,"div",100),t.EFF(13),t.k0s()(),t.j41(14,"div",101)(15,"div",102)(16,"span",103),t.EFF(17),t.k0s(),t.j41(18,"span",104),t.EFF(19),t.k0s()(),t.DNE(20,U,7,7,"div",105)(21,W,5,1,"div",106),t.j41(22,"div",107)(23,"span",103)(24,"strong"),t.EFF(25,"Total a pagar:"),t.k0s()(),t.j41(26,"span",104)(27,"strong"),t.EFF(28),t.k0s()()(),t.j41(29,"div",108)(30,"small",109),t.EFF(31),t.k0s()()()()),2&r){const e=n.$implicit,o=n.index,a=t.XpG(2);t.xc7("animation-delay",.1*o+"s"),t.R7$(6),t.SpI(" Piso ",e.floorNumber," "),t.R7$(2),t.Lme("",e.people," persona",1!==e.people?"s":""),t.R7$(2),t.Y8G("ngIf",e.adjustment<0),t.R7$(),t.Y8G("ngIf",e.redistributedAmount&&e.redistributedAmount>0),t.R7$(2),t.JRh(a.formatCurrency(e.finalAmount)),t.R7$(4),t.Lme("Base (",e.people," \xd7 ",a.formatCurrency(a.calculation.baseAmountPerPerson),"):"),t.R7$(2),t.JRh(a.formatCurrency(e.baseAmount)),t.R7$(),t.Y8G("ngIf",0!==e.adjustment),t.R7$(),t.Y8G("ngIf",e.redistributedAmount&&e.redistributedAmount>0),t.R7$(7),t.JRh(a.formatCurrency(e.finalAmount)),t.R7$(3),t.JRh(a.getFloorBreakdown(e))}}function K(r,n){if(1&r&&(t.j41(0,"div",119),t.EFF(1),t.k0s()),2&r){const e=t.XpG(2);t.R7$(),t.SpI(" (Incluye ",e.formatCurrency(e.calculation.totalAdjustments)," en ajustes) ")}}function H(r,n){if(1&r&&(t.j41(0,"div",120),t.EFF(1),t.k0s()),2&r){const e=t.XpG(2);t.R7$(),t.SpI(" Con ",e.formatCurrency(e.calculation.redistributionDetails.totalRedistributed)," redistribuidos autom\xe1ticamente ")}}function Z(r,n){if(1&r&&(t.j41(0,"span",121),t.EFF(1),t.k0s()),2&r){const e=t.XpG(2);t.R7$(),t.Lme(" \u2705 Balance perfecto: ",e.formatCurrency(e.calculation.totalAmount)," = ",e.formatCurrency(e.calculation.finalTotal)," ")}}function tt(r,n){if(1&r&&(t.j41(0,"span",121),t.EFF(1),t.k0s()),2&r){const e=t.XpG(2);t.R7$(),t.SpI(" \u26a0\ufe0f Diferencia m\xednima: ",e.formatCurrency(e.Math.abs(e.getTotalDifference()))," (redondeo) ")}}function et(r,n){if(1&r&&(t.j41(0,"div",122)(1,"h4",123),t.EFF(2,"\u{1f4c8} Estad\xedsticas"),t.k0s(),t.j41(3,"div",124)(4,"div",125)(5,"span",126),t.EFF(6,"Pisos con ajustes:"),t.k0s(),t.j41(7,"span",127),t.EFF(8),t.k0s()(),t.j41(9,"div",125)(10,"span",126),t.EFF(11,"Pisos con reducciones:"),t.k0s(),t.j41(12,"span",127),t.EFF(13),t.k0s()(),t.j41(14,"div",125)(15,"span",126),t.EFF(16,"Pisos que reciben redistribuci\xf3n:"),t.k0s(),t.j41(17,"span",127),t.EFF(18),t.k0s()(),t.j41(19,"div",125)(20,"span",126),t.EFF(21,"Total redistribuido:"),t.k0s(),t.j41(22,"span",127),t.EFF(23),t.k0s()()()()),2&r){const e=n.ngIf,o=t.XpG(2);t.R7$(8),t.JRh(e.floorsWithAdjustments),t.R7$(5),t.JRh(e.floorsWithReductions),t.R7$(5),t.JRh(e.floorsReceivingRedistribution),t.R7$(5),t.JRh(o.formatCurrency(e.totalRedistributed))}}function rt(r,n){if(1&r){const e=t.RV6();t.j41(0,"div",38)(1,"div",19)(2,"h2",20),t.EFF(3,"\u{1f4ca} Distribuci\xf3n de Agua"),t.k0s(),t.j41(4,"p",21),t.EFF(5,"Desglose detallado con redistribuci\xf3n autom\xe1tica"),t.k0s()(),t.j41(6,"div",66)(7,"div",67)(8,"div",68),t.EFF(9,"\u{1f4b0}"),t.k0s(),t.j41(10,"div",69)(11,"div",70),t.EFF(12),t.k0s(),t.j41(13,"div",71),t.EFF(14,"Total Factura"),t.k0s()()(),t.j41(15,"div",72)(16,"div",68),t.EFF(17,"\u{1f465}"),t.k0s(),t.j41(18,"div",69)(19,"div",70),t.EFF(20),t.k0s(),t.j41(21,"div",71),t.EFF(22,"Total Personas"),t.k0s()()(),t.j41(23,"div",73)(24,"div",68),t.EFF(25,"\u{1f4a7}"),t.k0s(),t.j41(26,"div",69)(27,"div",70),t.EFF(28),t.k0s(),t.j41(29,"div",71),t.EFF(30,"Por Persona"),t.k0s()()(),t.DNE(31,B,8,1,"div",74),t.k0s(),t.DNE(32,M,6,1,"div",75),t.j41(33,"div",39)(34,"div",40),t.EFF(35),t.k0s()(),t.j41(36,"div",76)(37,"h3",77),t.EFF(38,"\u{1f3e2} Desglose por Piso"),t.k0s(),t.j41(39,"div",78),t.DNE(40,Q,32,15,"div",79),t.k0s()(),t.j41(41,"div",80)(42,"div",81)(43,"div",82),t.EFF(44),t.k0s(),t.j41(45,"div",83),t.EFF(46,"Total Final (Igual al inicial)"),t.k0s(),t.DNE(47,K,2,1,"div",84)(48,H,2,1,"div",85),t.k0s(),t.j41(49,"div",86),t.DNE(50,Z,2,2,"span",87)(51,tt,2,1,"span",87),t.k0s()(),t.DNE(52,et,24,4,"div",88),t.j41(53,"div",43)(54,"button",44),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.onPreviousStep())}),t.j41(55,"span",35),t.EFF(56,"\u2190"),t.k0s(),t.EFF(57," Editar Datos "),t.k0s(),t.j41(58,"button",89),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.exportResults())}),t.j41(59,"span",35),t.EFF(60,"\u{1f4ca}"),t.k0s(),t.EFF(61," Exportar "),t.k0s(),t.j41(62,"button",90),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.resetCalculator())}),t.j41(63,"span",35),t.EFF(64,"\u{1f504}"),t.k0s(),t.EFF(65," Nueva Calculaci\xf3n "),t.k0s()()()}if(2&r){const e=t.XpG();t.R7$(12),t.JRh(e.formatCurrency(e.calculation.totalAmount)),t.R7$(8),t.JRh(e.calculation.totalPeople),t.R7$(8),t.JRh(e.formatCurrency(e.calculation.baseAmountPerPerson)),t.R7$(3),t.Y8G("ngIf",e.calculation.redistributionDetails&&e.calculation.redistributionDetails.totalRedistributed>0),t.R7$(),t.Y8G("ngIf",e.calculation.redistributionDetails&&e.calculation.redistributionDetails.totalRedistributed>0),t.R7$(3),t.SpI(" ",e.getSuggestion()," "),t.R7$(5),t.Y8G("ngForOf",e.calculation.floors),t.R7$(4),t.JRh(e.formatCurrency(e.calculation.finalTotal)),t.R7$(3),t.Y8G("ngIf",0!==e.calculation.totalAdjustments),t.R7$(),t.Y8G("ngIf",e.calculation.redistributionDetails&&e.calculation.redistributionDetails.totalRedistributed>0),t.R7$(2),t.Y8G("ngIf",e.Math.abs(e.getTotalDifference())<=.01),t.R7$(),t.Y8G("ngIf",e.Math.abs(e.getTotalDifference())>.01),t.R7$(),t.Y8G("ngIf",e.getCalculationStats())}}let ot=(()=>{class r{fb;router;aguaForm;calculation=null;showResults=!1;isCalculating=!1;currentStep=1;maxSteps=3;debounceTimeout;constructor(e,o){this.fb=e,this.router=o,this.aguaForm=this.fb.group({totalAmount:[null,[u.k0.required,u.k0.min(.01),this.currencyValidator]],numberOfFloors:[null,[u.k0.required,u.k0.min(1),u.k0.max(20),u.k0.pattern(/^\d+$/)]],floors:this.fb.array([])})}ngOnInit(){this.setupFormSubscriptions()}ngOnDestroy(){this.debounceTimeout&&clearTimeout(this.debounceTimeout)}setupFormSubscriptions(){this.aguaForm.get("totalAmount")?.valueChanges.subscribe(()=>{3===this.currentStep&&this.calculation&&this.debounceCalculation()}),this.aguaForm.get("numberOfFloors")?.valueChanges.subscribe(()=>{1===this.currentStep&&this.onFieldChange("numberOfFloors")}),this.floorsFormArray.valueChanges.subscribe(()=>{3===this.currentStep&&this.calculation&&this.debounceCalculation()})}debounceCalculation(){clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(()=>{this.isStep2Valid()&&this.calculateWaterBill()},300)}currencyValidator(e){const o=e.value;return o?/^\d+(\.\d{1,2})?$/.test(o.toString())?null:{invalidCurrency:!0}:null}adjustmentValidator(e){const o=e.value;return null===o||""===o||0===o||/^-?\d+(\.\d{1,2})?$/.test(o.toString())?null:{invalidAdjustment:!0}}get floorsFormArray(){return this.aguaForm.get("floors")}get floorFormGroups(){return this.floorsFormArray.controls}get Math(){return Math}onNextStep(){1===this.currentStep&&this.isStep1Valid()?(this.generateFloorForms(),this.currentStep=2):2===this.currentStep&&this.isStep2Valid()&&(this.calculateWaterBill(),this.currentStep=3)}onPreviousStep(){this.currentStep>1&&(this.currentStep--,1===this.currentStep&&(this.showResults=!1,this.calculation=null))}isStep1Valid(){const e=this.aguaForm.get("totalAmount"),o=this.aguaForm.get("numberOfFloors");return!(!e?.valid||!o?.valid)}isStep2Valid(){return 0!==this.floorsFormArray.length&&this.floorsFormArray.controls.every(e=>{const o=e.get("people"),a=e.get("adjustment");return o?.valid&&a?.valid})}generateFloorForms(){const e=parseInt(this.aguaForm.get("numberOfFloors")?.value);for(;0!==this.floorsFormArray.length;)this.floorsFormArray.removeAt(0);for(let o=1;o<=e;o++){const a=this.fb.group({floorNumber:[o],people:[null,[u.k0.required,u.k0.min(1),u.k0.max(20),u.k0.pattern(/^\d+$/)]],adjustment:[0,[this.adjustmentValidator]],adjustmentReason:["",[u.k0.maxLength(100)]]});this.floorsFormArray.push(a)}}calculateWithRedistribution(e,o){const a=o.reduce((s,p)=>s+parseInt(p.people),0),g=(e-o.reduce((s,p)=>{const b=parseFloat(p.adjustment)||0;return s+(b>0?b:0)},0))/a,c=o.map(s=>{const p=parseInt(s.people),b=g*p,at=parseFloat(s.adjustment)||0;return{floorNumber:s.floorNumber,people:p,baseAmount:b,adjustment:at,finalAmount:b,adjustmentReason:s.adjustmentReason?.trim()||"",redistributedAmount:0}}),f=c.reduce((s,p)=>s+(p.adjustment<0?Math.abs(p.adjustment):0),0),F=c.filter(s=>s.adjustment>=0),h=F.length>0?f/F.length:0;c.forEach(s=>{s.adjustment<0?(s.finalAmount=Math.max(0,s.baseAmount+s.adjustment),s.redistributedAmount=0):s.adjustment>0?(s.redistributedAmount=h,s.finalAmount=s.baseAmount+s.adjustment+h):(s.redistributedAmount=h,s.finalAmount=s.baseAmount+h)});const x={totalReduced:f,totalRedistributed:f,floorsWithReductions:c.filter(s=>s.adjustment<0).length,floorsReceivingRedistribution:F.length,redistributionPerFloor:h};return{floors:c,redistributionDetails:x}}calculateWaterBill(){this.isStep2Valid()&&(this.isCalculating=!0,setTimeout(()=>{try{const e=parseFloat(this.aguaForm.get("totalAmount")?.value),o=this.floorsFormArray.value,a=o.reduce((s,p)=>s+parseInt(p.people),0);if(0===a)throw new Error("Debe haber al menos una persona");const g=(e-o.reduce((s,p)=>{const b=parseFloat(p.adjustment)||0;return s+(b>0?b:0)},0))/a,{floors:c,redistributionDetails:f}=this.calculateWithRedistribution(e,o),F=c.reduce((s,p)=>s+p.adjustment,0),h=c.reduce((s,p)=>s+p.finalAmount,0);this.calculation={totalAmount:e,totalPeople:a,baseAmountPerPerson:g,floors:c,totalAdjustments:F,finalTotal:h,redistributionDetails:f},this.showResults=!0;const x=Math.abs(h-e);x>.01&&console.warn("Diferencia detectada en el total:",x)}catch(e){console.error("Error en el c\xe1lculo:",e),this.showErrorMessage("Error en el c\xe1lculo. Por favor, verifica los datos ingresados.")}finally{this.isCalculating=!1}},800))}showErrorMessage(e){console.error(e)}getErrorMessage(e,o){let a;if(a=void 0!==o?this.floorsFormArray.at(o)?.get(e):this.aguaForm.get(e),a?.errors&&(a?.touched||a?.dirty)){if(a.errors.required)return this.getRequiredMessage(e);if(a.errors.min)return this.getMinMessage(e,a.errors.min.min);if(a.errors.max)return this.getMaxMessage(e,a.errors.max.max);if(a.errors.pattern)return this.getPatternMessage(e);if(a.errors.invalidCurrency)return"Ingrese un monto v\xe1lido (ej: 150000.50)";if(a.errors.invalidAdjustment)return"Ingrese un valor num\xe9rico v\xe1lido";if(a.errors.maxlength)return"M\xe1ximo 100 caracteres permitidos"}return""}getRequiredMessage(e){return{totalAmount:"El monto total es requerido",numberOfFloors:"El n\xfamero de pisos es requerido",people:"La cantidad de personas es requerida"}[e]||"Este campo es requerido"}getMinMessage(e,o){return{totalAmount:`El monto debe ser mayor a $${o}`,numberOfFloors:`Debe ser al menos ${o} piso`,people:`Debe haber al menos ${o} persona`}[e]||`Valor m\xednimo: ${o}`}getMaxMessage(e,o){return{numberOfFloors:`M\xe1ximo ${o} pisos permitidos`,people:`M\xe1ximo ${o} personas por piso`}[e]||`Valor m\xe1ximo: ${o}`}getPatternMessage(e){return{totalAmount:"Ingrese un monto v\xe1lido (ej: 150000.50)",numberOfFloors:"Ingrese solo n\xfameros enteros",people:"Ingrese solo n\xfameros enteros",adjustment:"Ingrese un valor num\xe9rico v\xe1lido"}[e]||"Formato inv\xe1lido"}hasError(e,o){let a;return a=void 0!==o?this.floorsFormArray.at(o)?.get(e):this.aguaForm.get(e),!(!a?.errors||!a?.touched&&!a?.dirty)}formatCurrency(e){return isNaN(e)||null==e?"$0":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:2}).format(e)}resetCalculator(){this.aguaForm.dirty||this.calculation?confirm("\xbfEst\xe1s seguro de que quieres reiniciar la calculadora? Se perder\xe1n todos los datos.")&&this.performReset():this.performReset()}performReset(){for(this.aguaForm.reset(),this.calculation=null,this.showResults=!1,this.isCalculating=!1,this.currentStep=1;0!==this.floorsFormArray.length;)this.floorsFormArray.removeAt(0);this.aguaForm.patchValue({totalAmount:null,numberOfFloors:null}),this.aguaForm.markAsUntouched(),this.aguaForm.markAsPristine()}getTotalDifference(){return this.calculation?this.calculation.finalTotal-this.calculation.totalAmount:0}getProgressPercentage(){return Math.round(this.currentStep/this.maxSteps*100)}exportResults(){if(this.calculation)try{const e={fecha:(new Date).toISOString(),timestamp:Date.now(),calculo:this.calculation,resumen:{totalFactura:this.formatCurrency(this.calculation.totalAmount),totalPersonas:this.calculation.totalPeople,promedioPorPersona:this.formatCurrency(this.calculation.baseAmountPerPerson),totalAjustes:this.formatCurrency(this.calculation.totalAdjustments),totalFinal:this.formatCurrency(this.calculation.finalTotal),redistribucionTotal:this.calculation.redistributionDetails?this.formatCurrency(this.calculation.redistributionDetails.totalRedistributed):"$0"}},o=JSON.stringify(e,null,2),a=new Blob([o],{type:"application/json"}),i=URL.createObjectURL(a),d=document.createElement("a");d.href=i,d.download=`calculo-agua-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(i),console.log("Datos exportados:",e)}catch(e){console.error("Error al exportar:",e),alert("Error al exportar los datos. Por favor, intenta nuevamente.")}}onFieldChange(e,o){setTimeout(()=>{void 0!==o?(this.floorsFormArray.at(o)?.get(e)?.markAsTouched(),this.validateFloorLogic(o)):(this.aguaForm.get(e)?.markAsTouched(),this.validateStep1Logic(e))},150)}validateFloorLogic(e){const o=this.floorsFormArray.at(e);if(!o)return;const a=o.get("people")?.value,i=o.get("adjustment")?.value;if(a&&i&&this.aguaForm.get("totalAmount")?.value){const c=parseFloat(this.aguaForm.get("totalAmount")?.value)/(this.getCurrentTotalPeople()||1)*a;Math.abs(i)>.5*c&&console.warn(`Ajuste alto detectado en piso ${e+1}`)}}validateStep1Logic(e){if("numberOfFloors"===e){const o=this.aguaForm.get("numberOfFloors")?.value;o&&o>10&&console.log("Edificio grande detectado, considera revisar la distribuci\xf3n")}if("totalAmount"===e){const o=this.aguaForm.get("totalAmount")?.value;o&&o>1e6&&console.log("Monto alto detectado, verifica la cifra")}}getCurrentTotalPeople(){return this.floorsFormArray.controls.reduce((e,o)=>e+(parseInt(o.get("people")?.value)||0),0)}getSuggestion(){if(!this.calculation)return"";const e=Math.abs(this.getTotalDifference());return e<=1?"\u2705 La distribuci\xf3n est\xe1 perfectamente balanceada con redistribuci\xf3n autom\xe1tica":`\u26a0\ufe0f Diferencia m\xednima de ${this.formatCurrency(e)} debido a redondeos`}getRedistributionInfo(){if(!this.calculation?.redistributionDetails)return"";const e=this.calculation.redistributionDetails;return 0===e.totalReduced?"Sin redistribuciones necesarias":`${this.formatCurrency(e.totalReduced)} redistribuidos entre ${e.floorsReceivingRedistribution} pisos (${this.formatCurrency(e.redistributionPerFloor)} c/u)`}getCalculationStats(){if(!this.calculation)return null;const e=this.calculation.floors,o=e.map(a=>a.adjustment).filter(a=>0!==a);return{floorsWithAdjustments:e.filter(a=>0!==a.adjustment).length,floorsWithReductions:e.filter(a=>a.adjustment<0).length,floorsReceivingRedistribution:e.filter(a=>(a.redistributedAmount||0)>0).length,averageAdjustment:o.length>0?o.reduce((a,i)=>a+i,0)/o.length:0,maxAdjustment:o.length>0?Math.max(...o):0,minAdjustment:o.length>0?Math.min(...o):0,totalPositiveAdjustments:e.filter(a=>a.adjustment>0).reduce((a,i)=>a+i.adjustment,0),totalNegativeAdjustments:e.filter(a=>a.adjustment<0).reduce((a,i)=>a+Math.abs(i.adjustment),0),totalRedistributed:this.calculation.redistributionDetails?.totalRedistributed||0}}getFloorBreakdown(e){let o=`Base: ${this.formatCurrency(e.baseAmount)}`;return 0!==e.adjustment&&(o+=` | Ajuste: ${e.adjustment>0?"+":""}${this.formatCurrency(e.adjustment)}`),e.redistributedAmount&&e.redistributedAmount>0&&(o+=` | Redistribuci\xf3n: +${this.formatCurrency(e.redistributedAmount)}`),o}goToMenu(){this.router.navigate(["/"])}static \u0275fac=function(o){return new(o||r)(t.rXU(u.ok),t.rXU(C.Ix))};static \u0275cmp=t.VBU({type:r,selectors:[["app-agua"]],decls:36,vars:15,consts:[["autoplay","","muted","","loop","","playsinline","",1,"video-background"],["src","assets/principal.mp4","type","video/mp4"],[1,"back-menu-btn",3,"click"],[1,"agua-calculator-container"],[1,"calculator-card"],[1,"progress-container"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-steps"],[1,"step"],[1,"step-number"],[1,"step-label"],[1,"header"],[1,"header-icon"],[1,"header-title"],[1,"header-subtitle"],["class","step-content fade-in",4,"ngIf"],["class","step-content",4,"ngIf"],[1,"step-content","fade-in"],[1,"step-header"],[1,"step-title"],[1,"step-description"],[1,"agua-form",3,"formGroup"],[1,"form-group"],["for","totalAmount",1,"form-label"],[1,"input-wrapper"],[1,"input-icon"],["id","totalAmount","type","number","formControlName","totalAmount","placeholder","Ej: 250,000","step","0.01","min","0",1,"form-input",3,"blur","input"],["class","error-message",4,"ngIf"],[1,"field-hint"],[1,"hint-icon"],["for","numberOfFloors",1,"form-label"],["id","numberOfFloors","type","number","formControlName","numberOfFloors","placeholder","Ej: 4","min","1","max","20",1,"form-input",3,"blur","input"],[1,"form-actions"],["type","button",1,"btn-primary",3,"click","disabled"],[1,"btn-icon"],[1,"error-message"],[1,"error-icon"],[1,"step-content"],[1,"suggestion-card"],[1,"suggestion-content"],[1,"floors-container"],["class","floor-card",3,"formGroup",4,"ngFor","ngForOf"],[1,"button-group"],["type","button",1,"prev-btn",3,"click"],["type","button",1,"calculate-btn",3,"click","disabled"],["class","btn-content",4,"ngIf"],["class","loading-content",4,"ngIf"],[1,"floor-card",3,"formGroup"],[1,"floor-header"],[1,"floor-title"],[1,"floor-icon"],[1,"floor-status"],[4,"ngIf"],[1,"floor-content"],[1,"form-label"],[1,"input-container"],["type","number","formControlName","people","placeholder","2","min","1","max","20",1,"form-input","small",3,"blur","input"],[1,"label-help"],[1,"currency-symbol"],["type","number","formControlName","adjustment","placeholder","0","step","0.01",1,"form-input","small",3,"blur","input"],["class","field-hint",4,"ngIf"],["type","text","formControlName","adjustmentReason","placeholder","Ej: Mayor consumo por jard\xedn","maxlength","100",1,"form-input",3,"blur"],[1,"btn-content"],[1,"loading-content"],[1,"spinner"],[1,"summary-cards"],[1,"summary-card","primary"],[1,"summary-icon"],[1,"summary-content"],[1,"summary-value"],[1,"summary-label"],[1,"summary-card","secondary"],[1,"summary-card","accent"],["class","summary-card accent",4,"ngIf"],["class","suggestion-card",4,"ngIf"],[1,"floors-breakdown"],[1,"breakdown-title"],[1,"floors-results"],["class","floor-result-card",3,"animation-delay",4,"ngFor","ngForOf"],[1,"final-total"],[1,"total-display"],[1,"total-amount"],[1,"total-label"],["class","total-adjustments",4,"ngIf"],["style","font-size: 12px; color: rgba(255,255,255,0.8); font-style: italic; margin-top: 4px;",4,"ngIf"],[2,"margin-top","12px","text-align","center"],["style","color: rgba(255,255,255,0.9); font-weight: 500;",4,"ngIf"],["style","background: #f8f9fa; border-radius: 12px; padding: 16px; margin-top: 20px;",4,"ngIf"],["type","button",1,"export-btn",3,"click"],["type","button",1,"reset-btn",3,"click"],[1,"floor-result-card"],[1,"floor-result-header"],[1,"floor-info"],[1,"floor-number"],[1,"floor-emoji"],[1,"people-count"],[2,"display","flex","gap","8px","margin-top","4px"],["style","background: #ffebee; color: #c62828; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;",4,"ngIf"],["style","background: #e8f5e8; color: #2e7d32; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;",4,"ngIf"],[1,"floor-total"],[1,"floor-breakdown"],[1,"breakdown-row"],[1,"breakdown-label"],[1,"breakdown-value"],["class","breakdown-row adjustment",4,"ngIf"],["class","breakdown-row","style","background: #e8f5e8; border-radius: 6px; padding: 8px; margin: 4px 0;",4,"ngIf"],[1,"breakdown-row","total"],[2,"margin-top","8px","padding","8px","background","#f8f9fa","border-radius","6px","border-left","3px solid #6c757d"],[2,"color","#6c757d","font-size","12px","line-height","1.4"],[2,"background","#ffebee","color","#c62828","padding","2px 8px","border-radius","12px","font-size","12px","font-weight","500"],[2,"background","#e8f5e8","color","#2e7d32","padding","2px 8px","border-radius","12px","font-size","12px","font-weight","500"],[1,"breakdown-row","adjustment"],[1,"adjustment-type"],["class","adjustment-reason",4,"ngIf"],[1,"adjustment-reason"],[1,"breakdown-row",2,"background","#e8f5e8","border-radius","6px","padding","8px","margin","4px 0"],[1,"breakdown-label",2,"color","#2e7d32","font-weight","500"],[1,"breakdown-value",2,"color","#2e7d32 !important","font-weight","600"],[1,"total-adjustments"],[2,"font-size","12px","color","rgba(255,255,255,0.8)","font-style","italic","margin-top","4px"],[2,"color","rgba(255,255,255,0.9)","font-weight","500"],[2,"background","#f8f9fa","border-radius","12px","padding","16px","margin-top","20px"],[2,"margin","0 0 12px 0","color","#495057"],[2,"display","grid","grid-template-columns","repeat(auto-fit, minmax(200px, 1fr))","gap","12px"],[2,"display","flex","justify-content","space-between","align-items","center","padding","8px 12px","background","white","border-radius","6px","border","1px solid #dee2e6"],[2,"color","#6c757d","font-size","14px"],[2,"font-weight","600","color","#495057"]],template:function(o,a){1&o&&(t.j41(0,"video",0),t.nrm(1,"source",1),t.EFF(2," Tu navegador no soporta video HTML5.\n"),t.k0s(),t.j41(3,"button",2),t.bIt("click",function(){return a.goToMenu()}),t.EFF(4," \u2190 Men\xfa\n"),t.k0s(),t.j41(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6),t.nrm(9,"div",7),t.k0s(),t.j41(10,"div",8)(11,"div",9)(12,"span",10),t.EFF(13,"1"),t.k0s(),t.j41(14,"span",11),t.EFF(15,"Datos B\xe1sicos"),t.k0s()(),t.j41(16,"div",9)(17,"span",10),t.EFF(18,"2"),t.k0s(),t.j41(19,"span",11),t.EFF(20,"Personas por Piso"),t.k0s()(),t.j41(21,"div",9)(22,"span",10),t.EFF(23,"3"),t.k0s(),t.j41(24,"span",11),t.EFF(25,"Resultados"),t.k0s()()()(),t.j41(26,"div",12)(27,"div",13),t.EFF(28,"\u{1f4a7}"),t.k0s(),t.j41(29,"h1",14),t.EFF(30,"Calculadora de Agua"),t.k0s(),t.j41(31,"p",15),t.EFF(32,"Distribuci\xf3n proporcional con redistribuci\xf3n autom\xe1tica de ajustes"),t.k0s()(),t.DNE(33,S,34,8,"div",16)(34,V,20,7,"div",17)(35,rt,66,13,"div",17),t.k0s()()),2&o&&(t.R7$(9),t.xc7("width",a.getProgressPercentage(),"%"),t.R7$(2),t.AVh("active",a.currentStep>=1)("completed",a.currentStep>1),t.R7$(5),t.AVh("active",a.currentStep>=2)("completed",a.currentStep>2),t.R7$(5),t.AVh("active",a.currentStep>=3),t.R7$(12),t.Y8G("ngIf",1===a.currentStep),t.R7$(),t.Y8G("ngIf",2===a.currentStep),t.R7$(),t.Y8G("ngIf",3===a.currentStep&&a.calculation))},dependencies:[y.MD,y.Sq,y.bT,u.X1,u.qT,u.me,u.Q0,u.BC,u.cb,u.tU,u.VZ,u.zX,u.j4,u.JD],styles:[':root{--primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);--secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);--success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);--font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;--font-size-xs: .75rem;--font-size-sm: .875rem;--font-size-base: 1rem;--font-size-lg: 1.125rem;--font-size-xl: 1.25rem;--font-size-2xl: 1.5rem;--font-size-3xl: 1.875rem;--font-size-4xl: 2.25rem;--space-1: .25rem;--space-2: .5rem;--space-3: .75rem;--space-4: 1rem;--space-5: 1.25rem;--space-6: 1.5rem;--space-8: 2rem;--space-10: 2.5rem;--space-12: 3rem;--space-16: 4rem;--space-20: 5rem;--border-radius: .75rem;--border-radius-lg: 1rem;--border-radius-xl: 1.5rem;--border-radius-2xl: 2rem;--shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, .05);--shadow: 0 1px 3px 0 rgba(0, 0, 0, .1), 0 1px 2px 0 rgba(0, 0, 0, .06);--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, .1), 0 2px 4px -1px rgba(0, 0, 0, .06);--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, .1), 0 4px 6px -2px rgba(0, 0, 0, .05);--shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, .1), 0 10px 10px -5px rgba(0, 0, 0, .04);--shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, .25)}*{margin:0;padding:0;box-sizing:border-box}@keyframes fadeInUp{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}@keyframes pulse{0%,to{opacity:1}50%{opacity:.5}}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes glow{0%,to{box-shadow:0 0 5px #667eea80}50%{box-shadow:0 0 20px #667eeacc}}.video-background{position:fixed;top:0;left:0;width:100vw;height:100vh;object-fit:cover;z-index:0}.back-menu-btn{position:fixed;top:20px;left:20px;background-color:#0061a8;color:#fff;border:none;border-radius:8px;padding:10px 16px;font-size:16px;cursor:pointer;z-index:10;box-shadow:0 2px 6px #0000004d;transition:background-color .3s,transform .3s;animation:slideIn .5s ease-out forwards;opacity:0}.back-menu-btn:hover{background-color:#004c7a;transform:scale(1.1)}@keyframes slideIn{0%{transform:translate(-30px);opacity:0}to{transform:translate(0);opacity:1}}.agua-calculator-container{min-height:100vh;background:var(--background-gradient);display:flex;align-items:center;justify-content:center;padding:var(--space-8);font-family:var(--font-family);line-height:1.6;color:var(--gray-800)}.calculator-card{background:#ffffff9a;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.2);border-radius:var(--border-radius-2xl);box-shadow:var(--shadow-2xl);padding:var(--space-12);width:100%;max-width:1200px;position:relative;overflow:hidden;transition:all .3s ease}.calculator-card:before{content:"";position:absolute;top:0;left:0;right:0;height:6px;background:var(--primary-gradient);border-radius:var(--border-radius-2xl) var(--border-radius-2xl) 0 0}.progress-container{margin-bottom:var(--space-16)}.progress-bar{height:8px;background:var(--gray-200);border-radius:var(--border-radius);overflow:hidden;margin-bottom:var(--space-8);position:relative}.progress-fill{height:100%;background:var(--primary-gradient);border-radius:var(--border-radius);transition:width .8s cubic-bezier(.4,0,.2,1);position:relative}.progress-fill:after{content:"";position:absolute;top:0;right:0;bottom:0;width:30px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.4));animation:pulse 2s infinite}.progress-steps{display:flex;justify-content:space-between;align-items:center;max-width:600px;margin:0 auto}.step{display:flex;flex-direction:column;align-items:center;opacity:.4;transition:all .4s ease}.step.active{opacity:1;transform:scale(1.1)}.step.completed{opacity:1}.step-number{width:50px;height:50px;border-radius:50%;background:var(--gray-300);color:var(--gray-600);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:var(--font-size-lg);margin-bottom:var(--space-3);transition:all .4s ease}.step.active .step-number{background:var(--primary-gradient);color:#fff;box-shadow:0 0 20px #667eea66;animation:bounce 2s infinite}.step.completed .step-number{background:var(--success-gradient);color:#fff}.step-label{font-size:var(--font-size-sm);font-weight:600;color:var(--gray-600);text-align:center;transition:color .3s ease}.step.active .step-label{color:var(--primary)}.header{text-align:center;margin-bottom:var(--space-16);padding-top:var(--space-8)}.header-icon{font-size:4rem;margin-bottom:var(--space-6);animation:pulse 3s infinite}.header-title{font-size:var(--font-size-4xl);font-weight:800;background:var(--primary-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:var(--space-4);line-height:1.2}.header-subtitle{font-size:var(--font-size-xl);color:var(--gray-600);max-width:600px;margin:0 auto;line-height:1.5}.step-content{animation:fadeInUp .6s ease-out}.fade-in{animation:fadeInUp .4s ease}.step-header{text-align:center;margin-bottom:var(--space-12)}.step-title{font-size:var(--font-size-3xl);font-weight:700;color:var(--gray-800);margin-bottom:var(--space-4)}.step-description{font-size:var(--font-size-lg);color:var(--gray-600)}.agua-form{display:flex;flex-direction:column;gap:var(--space-8)}.form-group{display:flex;flex-direction:column;gap:var(--space-3)}.form-label{font-weight:600;font-size:var(--font-size-lg);color:var(--gray-800);display:flex;align-items:center;gap:var(--space-3)}.label-help{font-size:var(--font-size-sm);font-weight:400;color:var(--gray-500);margin-left:var(--space-2)}.input-wrapper{position:relative;display:flex;align-items:center}.input-icon{position:absolute;left:var(--space-5);color:var(--gray-500);font-weight:600;font-size:var(--font-size-lg);pointer-events:none;z-index:1}.form-input{width:100%;padding:var(--space-5) var(--space-6);padding-left:var(--space-12);border:2px solid var(--gray-300);border-radius:var(--border-radius-lg);font-size:var(--font-size-lg);font-weight:500;background:var(--white);transition:all .3s ease;box-shadow:var(--shadow-sm);color:var(--gray-800)}.form-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px #667eea1a;transform:translateY(-2px)}.form-input::placeholder{color:var(--gray-400);font-weight:400}.input-container{position:relative}.input-container .form-input{padding-left:var(--space-5)}.input-container .form-input.small{font-size:var(--font-size-base);padding:var(--space-4) var(--space-5)}.currency-symbol{position:absolute;left:var(--space-4);top:50%;transform:translateY(-50%);color:var(--gray-500);font-weight:600;pointer-events:none;z-index:1}.input-container .form-input:has(~.currency-symbol){padding-left:var(--space-10)}.input-wrapper.error .form-input,.input-container.error .form-input{border-color:var(--error);background:#ffa0850d}.input-container.success .form-input{border-color:var(--success);box-shadow:0 0 0 4px #4facfe1a}.input-container.success:after{content:"\\2713";position:absolute;top:50%;right:var(--space-4);transform:translateY(-50%);color:var(--success);font-weight:700;font-size:var(--font-size-lg)}.error-message{display:flex;align-items:center;gap:var(--space-2);font-size:var(--font-size-base);font-weight:500;color:var(--error);animation:fadeInUp .3s ease}.error-icon{font-size:var(--font-size-base)}.field-hint{display:flex;align-items:center;gap:var(--space-2);font-size:var(--font-size-sm);color:var(--gray-500)}.hint-icon{font-size:var(--font-size-sm)}.form-actions{display:flex;justify-content:flex-end;margin-top:var(--space-8)}.btn-primary{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-5) var(--space-8);font-size:var(--font-size-lg);font-weight:700;border:none;border-radius:var(--border-radius-lg);background:var(--primary-gradient);color:#fff;cursor:pointer;transition:all .3s ease;box-shadow:var(--shadow-lg);text-transform:uppercase;letter-spacing:1px}.btn-primary:hover:enabled{transform:translateY(-3px);box-shadow:var(--shadow-xl)}.btn-primary:active:enabled{transform:translateY(-1px)}.btn-primary:disabled{background:var(--gray-300);color:var(--gray-500);cursor:not-allowed;transform:none;box-shadow:var(--shadow-sm)}.btn-icon{font-size:var(--font-size-lg)}.floors-container{display:grid;gap:var(--space-6);margin-bottom:var(--space-12)}.floor-card{background:var(--white);border:2px solid var(--gray-200);border-radius:var(--border-radius-xl);padding:var(--space-8);transition:all .3s ease;box-shadow:var(--shadow-md);position:relative;overflow:hidden}.floor-card:before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:var(--secondary-gradient)}.floor-card:hover{border-color:var(--primary);transform:translateY(-5px);box-shadow:var(--shadow-xl)}.floor-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-6)}.floor-title{display:flex;align-items:center;gap:var(--space-3);font-size:var(--font-size-xl);font-weight:700;color:var(--gray-800)}.floor-icon{font-size:var(--font-size-2xl)}.floor-status{font-size:var(--font-size-2xl);transition:all .3s ease}.floor-status.valid{animation:bounce 1s ease-in-out}.floor-content{display:grid;grid-template-columns:1fr 1fr;gap:var(--space-6)}.floor-content .form-group:last-child{grid-column:1 / -1}.button-group{display:flex;gap:var(--space-4);margin-top:var(--space-12);flex-wrap:wrap}.prev-btn,.calculate-btn{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-5) var(--space-8);font-size:var(--font-size-lg);font-weight:700;border:none;border-radius:var(--border-radius-lg);cursor:pointer;transition:all .3s ease;box-shadow:var(--shadow-md)}.prev-btn{background:var(--gray-200);color:var(--gray-700)}.prev-btn:hover{background:var(--gray-300);transform:translateY(-2px);box-shadow:var(--shadow-lg)}.calculate-btn{background:var(--success-gradient);color:#fff;flex:1;min-width:250px;justify-content:center}.calculate-btn:hover:not(:disabled){transform:translateY(-3px);box-shadow:var(--shadow-xl)}.calculate-btn:disabled{background:var(--gray-300);color:var(--gray-500);cursor:not-allowed;transform:none}.calculate-btn.loading{pointer-events:none}.btn-content,.loading-content{display:flex;align-items:center;gap:var(--space-3)}.spinner{width:24px;height:24px;border:3px solid rgba(255,255,255,.3);border-top:3px solid white;border-radius:50%;animation:spin 1s linear infinite}.summary-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:var(--space-6);margin-bottom:var(--space-12)}.summary-card{display:flex;align-items:center;gap:var(--space-6);padding:var(--space-8);border-radius:var(--border-radius-xl);transition:all .3s ease;position:relative;overflow:hidden;box-shadow:var(--shadow-lg)}.summary-card:hover{transform:translateY(-5px);box-shadow:var(--shadow-xl)}.summary-card.primary{background:var(--primary-gradient);color:#fff}.summary-card.secondary{background:var(--secondary-gradient);color:#fff}.summary-card.accent{background:var(--success-gradient);color:#fff}.summary-icon{font-size:3rem;opacity:.9}.summary-content{flex:1}.summary-value{font-size:var(--font-size-3xl);font-weight:800;margin-bottom:var(--space-2);line-height:1.2}.summary-label{font-size:var(--font-size-base);opacity:.9;text-transform:uppercase;letter-spacing:1px;font-weight:600}.suggestion-card{background:linear-gradient(135deg,#f0f9ff,#e0f2fe);border:2px solid rgba(79,172,254,.3);border-radius:var(--border-radius-lg);padding:var(--space-6);margin-bottom:var(--space-12);text-align:center;box-shadow:var(--shadow-sm)}.suggestion-content{color:var(--gray-800);font-size:var(--font-size-lg);font-weight:600}.balance-alert{display:flex;align-items:center;gap:var(--space-4);padding:var(--space-6);background:#ff9a9e1a;border:2px solid var(--warning);border-radius:var(--border-radius-lg);margin-bottom:var(--space-12);animation:glow 2s infinite}.alert-icon{font-size:var(--font-size-2xl)}.alert-content{flex:1;color:var(--gray-800);font-size:var(--font-size-lg);font-weight:600}.auto-balance-btn{padding:var(--space-3) var(--space-6);background:var(--warning);color:#fff;border:none;border-radius:var(--border-radius);font-size:var(--font-size-base);font-weight:700;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:var(--space-2)}.auto-balance-btn:hover{background:#ff9a9ecc;transform:translateY(-2px)}.floors-breakdown{margin-bottom:var(--space-16)}.breakdown-title{font-size:var(--font-size-2xl);font-weight:700;color:var(--gray-800);text-align:center;margin-bottom:var(--space-8)}.floors-results{display:grid;gap:var(--space-6)}.floor-result-card{background:var(--white);border:2px solid var(--gray-200);border-radius:var(--border-radius-xl);padding:var(--space-8);transition:all .3s ease;box-shadow:var(--shadow-md);animation:fadeInUp .5s ease forwards}.floor-result-card:hover{border-color:var(--primary);transform:translateY(-3px);box-shadow:var(--shadow-xl)}.floor-result-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-6);padding-bottom:var(--space-6);border-bottom:2px solid var(--gray-200)}.floor-info{display:flex;flex-direction:column;gap:var(--space-2)}.floor-number{font-size:var(--font-size-xl);font-weight:700;color:var(--gray-800);display:flex;align-items:center;gap:var(--space-3)}.floor-emoji{font-size:var(--font-size-2xl)}.people-count{font-size:var(--font-size-sm);color:var(--gray-600);text-transform:uppercase;letter-spacing:1px;font-weight:600}.floor-total{font-size:var(--font-size-3xl);font-weight:800;color:var(--primary)}.floor-breakdown{display:grid;gap:var(--space-4)}.breakdown-row{display:flex;justify-content:space-between;align-items:center;padding:var(--space-3) 0;font-size:var(--font-size-base)}.breakdown-row.adjustment{color:var(--gray-600)}.breakdown-row.total{border-top:2px solid var(--gray-200);margin-top:var(--space-4);padding-top:var(--space-4);font-weight:700;font-size:var(--font-size-lg)}.breakdown-label,.adjustment-type{font-weight:600}.adjustment-reason{display:block;font-size:var(--font-size-sm);color:var(--gray-500);font-style:italic;margin-top:var(--space-1);font-weight:400}.breakdown-value{font-weight:700}.breakdown-value.positive{color:var(--success)}.breakdown-value.negative{color:var(--error)}.final-total{background:var(--primary-gradient);color:#fff;text-align:center;padding:var(--space-16);border-radius:var(--border-radius-2xl);margin-bottom:var(--space-16);position:relative;overflow:hidden;box-shadow:var(--shadow-2xl)}.final-total:before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,.1) 0%,transparent 70%);animation:pulse 4s infinite}.total-display{position:relative;z-index:1}.total-amount{font-size:4rem;font-weight:900;margin-bottom:var(--space-4);text-shadow:2px 2px 4px rgba(0,0,0,.1);line-height:1.1}.total-label{font-size:var(--font-size-xl);opacity:.9;text-transform:uppercase;letter-spacing:2px;margin-bottom:var(--space-4);font-weight:700}.total-adjustments{font-size:var(--font-size-base);opacity:.8;font-style:italic}.reset-btn,.export-btn{display:flex;align-items:center;gap:var(--space-3);padding:var(--space-4) var(--space-6);font-size:var(--font-size-base);font-weight:600;border:2px solid var(--gray-300);border-radius:var(--border-radius-lg);background:var(--white);color:var(--gray-700);cursor:pointer;transition:all .3s ease}.reset-btn:hover{border-color:var(--error);color:var(--error);transform:translateY(-2px)}.export-btn{background:var(--success-gradient);color:#fff;border:none}.export-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}@media (max-width: 768px){.calculator-card{padding:var(--space-6);margin:var(--space-4);max-width:100%}.header-title{font-size:var(--font-size-3xl)}.header-icon{font-size:3rem}.step-title{font-size:var(--font-size-2xl)}.summary-cards{grid-template-columns:1fr}.summary-value{font-size:var(--font-size-2xl)}.floor-content{grid-template-columns:1fr}.button-group{flex-direction:column}.calculate-btn{min-width:auto}.total-amount{font-size:var(--font-size-4xl)}.progress-steps{flex-direction:column;gap:var(--space-4)}.step{flex-direction:row;gap:var(--space-4)}.step-number{margin-bottom:0}.floor-result-header{flex-direction:column;align-items:flex-start;gap:var(--space-3)}.balance-alert{flex-direction:column;text-align:center}.auto-balance-btn{margin-left:0;margin-top:var(--space-4)}}@media (max-width: 480px){.agua-calculator-container,.calculator-card{padding:var(--space-4)}.header-title{font-size:var(--font-size-2xl)}.total-amount{font-size:var(--font-size-3xl)}.form-input{font-size:var(--font-size-base)}.summary-card{padding:var(--space-6)}.summary-icon{font-size:var(--font-size-2xl)}.floor-card,.floor-result-card{padding:var(--space-6)}}@media (prefers-reduced-motion: reduce){*{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}.form-input:focus,.btn-primary:focus,.calculate-btn:focus,.prev-btn:focus,.reset-btn:focus,.export-btn:focus,.auto-balance-btn:focus{outline:none;box-shadow:0 0 0 4px #667eea33}.form-input:hover:not(:disabled){border-color:var(--primary-light)}.floor-card:focus-within{border-color:var(--primary);box-shadow:var(--shadow-lg)}.calculator-card:hover{box-shadow:0 30px 60px -12px #00000040}\n'],encapsulation:2,data:{animation:[j("fadeIn",[w(":enter",[_({opacity:0,transform:"translateY(30px)"}),E("600ms ease-out",_({opacity:1,transform:"translateY(0)"}))])]),j("slideIn",[w(":enter",[D(".floor-card",[_({opacity:0,transform:"translateY(50px)"}),A(100,[E("400ms ease-out",_({opacity:1,transform:"translateY(0)"}))])],{optional:!0})])])]}})}return r})()}}]);